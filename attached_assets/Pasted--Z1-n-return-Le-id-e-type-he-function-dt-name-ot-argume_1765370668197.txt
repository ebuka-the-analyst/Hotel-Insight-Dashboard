${Z1(n)}`);return{...Le,id:_e,type:he,function:{...dt,name:ot,arguments:$e}}})}}:{...E,message:{...q,content:I,role:B,refusal:v.refusal??null},finish_reason:y,index:_,logprobs:S}}),created:o,model:c,object:"chat.completion",...f?{system_fingerprint:f}:{}};return I7(g,e)}function Z1(n){return JSON.stringify(n)}var ph=class n extends Dl{static fromReadableStream(e){let r=new n(null);return r._run(()=>r._fromReadableStream(e)),r}static runTools(e,r,t){let o=new n(r),c={...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"runTools"}};return o._run(()=>o._runTools(e,r,c)),o}};var ro=class extends Pe{constructor(){super(...arguments),this.messages=new Rl(this._client)}create(e,r){return this._client.post("/chat/completions",{body:e,...r,stream:e.stream??!1})}retrieve(e,r){return this._client.get(Fe`/chat/completions/${e}`,r)}update(e,r,t){return this._client.post(Fe`/chat/completions/${e}`,{body:r,...t})}list(e={},r){return this._client.getAPIList("/chat/completions",Xt,{query:e,...r})}delete(e,r){return this._client.delete(Fe`/chat/completions/${e}`,r)}parse(e,r){return O7(e.tools),this._client.chat.completions.create(e,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>sh(t,e))}runTools(e,r){return e.stream?ph.runTools(this._client,e,r):fh.runTools(this._client,e,r)}stream(e,r){return Dl.createChatCompletion(this._client,e,r)}};ro.Messages=Rl;var nc=class extends Pe{constructor(){super(...arguments),this.completions=new ro(this._client)}};nc.Completions=ro;var q7=Symbol("brand.privateNullableHeaders");function*sme(n){if(!n)return;if(q7 in n){let{values:t,nulls:o}=n;yield*t.entries();for(let c of o)yield[c,null];return}let e=!1,r;n instanceof Headers?r=n.entries():Z4(n)?r=n:(e=!0,r=Object.entries(n??{}));for(let t of r){let o=t[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let c=Z4(t[1])?t[1]:[t[1]],f=!1;for(let d of c)d!==void 0&&(e&&!f&&(f=!0,yield[o,null]),yield[o,d])}}var Ke=n=>{let e=new Headers,r=new Set;for(let t of n){let o=new Set;for(let[c,f]of sme(t)){let d=c.toLowerCase();o.has(d)||(e.delete(c),o.add(d)),f===null?(e.delete(c),r.add(d)):(e.append(c,f),r.delete(d))}}return{[q7]:!0,values:e,nulls:r}};var Vf=class extends Pe{create(e,r){return this._client.post("/audio/speech",{body:e,...r,headers:Ke([{Accept:"application/octet-stream"},r?.headers]),__binaryResponse:!0})}};var Kf=class extends Pe{create(e,r){return this._client.post("/audio/transcriptions",oi({body:e,...r,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};var Qf=class extends Pe{create(e,r){return this._client.post("/audio/translations",oi({body:e,...r,__metadata:{model:e.model}},this._client))}};var Rs=class extends Pe{constructor(){super(...arguments),this.transcriptions=new Kf(this._client),this.translations=new Qf(this._client),this.speech=new Vf(this._client)}};Rs.Transcriptions=Kf;Rs.Translations=Qf;Rs.Speech=Vf;var Pl=class extends Pe{create(e,r){return this._client.post("/batches",{body:e,...r})}retrieve(e,r){return this._client.get(Fe`/batches/${e}`,r)}list(e={},r){return this._client.getAPIList("/batches",Xt,{query:e,...r})}cancel(e,r){return this._client.post(Fe`/batches/${e}/cancel`,r)}};var Xf=class extends Pe{create(e,r){return this._client.post("/assistants",{body:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(Fe`/assistants/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,t){return this._client.post(Fe`/assistants/${e}`,{body:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e={},r){return this._client.getAPIList("/assistants",Xt,{query:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(Fe`/assistants/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Yf=class extends Pe{create(e,r){return this._client.post("/realtime/sessions",{body:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var Jf=class extends Pe{create(e,r){return this._client.post("/realtime/transcription_sessions",{body:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}};var ac=class extends Pe{constructor(){super(...arguments),this.sessions=new Yf(this._client),this.transcriptionSessions=new Jf(this._client)}};ac.Sessions=Yf;ac.TranscriptionSessions=Jf;var Zf=class extends Pe{create(e,r){return this._client.post("/chatkit/sessions",{body:e,...r,headers:Ke([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}cancel(e,r){return this._client.post(Fe`/chatkit/sessions/${e}/cancel`,{...r,headers:Ke([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}};var e0=class extends Pe{retrieve(e,r){return this._client.get(Fe`/chatkit/threads/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}list(e={},r){return this._client.getAPIList("/chatkit/threads",Zs,{query:e,...r,headers:Ke([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}delete(e,r){return this._client.delete(Fe`/chatkit/threads/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"chatkit_beta=v1"},r?.headers])})}listItems(e,r={},t){return this._client.getAPIList(Fe`/chatkit/threads/${e}/items`,Zs,{query:r,...t,headers:Ke([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}};var ic=class extends Pe{constructor(){super(...arguments),this.sessions=new Zf(this._client),this.threads=new e0(this._client)}};ic.Sessions=Zf;ic.Threads=e0;var t0=class extends Pe{create(e,r,t){return this._client.post(Fe`/threads/${e}/messages`,{body:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,r,t){let{thread_id:o}=r;return this._client.get(Fe`/threads/${o}/messages/${e}`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,r,t){let{thread_id:o,...c}=r;return this._client.post(Fe`/threads/${o}/messages/${e}`,{body:c,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,r={},t){return this._client.getAPIList(Fe`/threads/${e}/messages`,Xt,{query:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,r,t){let{thread_id:o}=r;return this._client.delete(Fe`/threads/${o}/messages/${e}`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var r0=class extends Pe{retrieve(e,r,t){let{thread_id:o,run_id:c,...f}=r;return this._client.get(Fe`/threads/${o}/runs/${c}/steps/${e}`,{query:f,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,r,t){let{thread_id:o,...c}=r;return this._client.getAPIList(Fe`/threads/${o}/runs/${e}/steps`,Xt,{query:c,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var U7=n=>{if(typeof Buffer<"u"){let e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(n),r=e.length,t=new Uint8Array(r);for(let o=0;o<r;o++)t[o]=e.charCodeAt(o);return Array.from(new Float32Array(t.buffer))}};var sc=n=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[n]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(n)?.trim()};var ia,Nl,PS,Is,ev,Ki,Ml,n0,Ol,nv,ci,tv,rv,mh,dh,hh,$7,z7,G7,H7,W7,V7,K7,no=class extends tc{constructor(){super(...arguments),ia.add(this),PS.set(this,[]),Is.set(this,{}),ev.set(this,{}),Ki.set(this,void 0),Ml.set(this,void 0),n0.set(this,void 0),Ol.set(this,void 0),nv.set(this,void 0),ci.set(this,void 0),tv.set(this,void 0),rv.set(this,void 0),mh.set(this,void 0)}[(PS=new WeakMap,Is=new WeakMap,ev=new WeakMap,Ki=new WeakMap,Ml=new WeakMap,n0=new WeakMap,Ol=new WeakMap,nv=new WeakMap,ci=new WeakMap,tv=new WeakMap,rv=new WeakMap,mh=new WeakMap,ia=new WeakSet,Symbol.asyncIterator)](){let e=[],r=[],t=!1;return this.on("event",o=>{let c=r.shift();c?c.resolve(o):e.push(o)}),this.on("end",()=>{t=!0;for(let o of r)o.resolve(void 0);r.length=0}),this.on("abort",o=>{t=!0;for(let c of r)c.reject(o);r.length=0}),this.on("error",o=>{t=!0;for(let c of r)c.reject(o);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:t?{value:void 0,done:!0}:new Promise((c,f)=>r.push({resolve:c,reject:f})).then(c=>c?{value:c,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let r=new Nl;return r._run(()=>r._fromReadableStream(e)),r}async _fromReadableStream(e,r){let t=r?.signal;t&&(t.aborted&&this.controller.abort(),t.addEventListener("abort",()=>this.controller.abort())),this._connected();let o=Ts.fromReadableStream(e,this.controller);for await(let c of o)ue(this,ia,"m",dh).call(this,c);if(o.controller.signal?.aborted)throw new Tn;return this._addRun(ue(this,ia,"m",hh).call(this))}toReadableStream(){return new Ts(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,r,t,o){let c=new Nl;return c._run(()=>c._runToolAssistantStream(e,r,t,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}})),c}async _createToolAssistantStream(e,r,t,o){let c=o?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort()));let f={...t,stream:!0},d=await e.submitToolOutputs(r,f,{...o,signal:this.controller.signal});this._connected();for await(let g of d)ue(this,ia,"m",dh).call(this,g);if(d.controller.signal?.aborted)throw new Tn;return this._addRun(ue(this,ia,"m",hh).call(this))}static createThreadAssistantStream(e,r,t){let o=new Nl;return o._run(()=>o._threadAssistantStream(e,r,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"stream"}})),o}static createAssistantStream(e,r,t,o){let c=new Nl;return c._run(()=>c._runAssistantStream(e,r,t,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}})),c}currentEvent(){return ue(this,tv,"f")}currentRun(){return ue(this,rv,"f")}currentMessageSnapshot(){return ue(this,Ki,"f")}currentRunStepSnapshot(){return ue(this,mh,"f")}async finalRunSteps(){return await this.done(),Object.values(ue(this,Is,"f"))}async finalMessages(){return await this.done(),Object.values(ue(this,ev,"f"))}async finalRun(){if(await this.done(),!ue(this,Ml,"f"))throw Error("Final run was not received.");return ue(this,Ml,"f")}async _createThreadAssistantStream(e,r,t){let o=t?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let c={...r,stream:!0},f=await e.createAndRun(c,{...t,signal:this.controller.signal});this._connected();for await(let d of f)ue(this,ia,"m",dh).call(this,d);if(f.controller.signal?.aborted)throw new Tn;return this._addRun(ue(this,ia,"m",hh).call(this))}async _createAssistantStream(e,r,t,o){let c=o?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort()));let f={...t,stream:!0},d=await e.create(r,f,{...o,signal:this.controller.signal});this._connected();for await(let g of d)ue(this,ia,"m",dh).call(this,g);if(d.controller.signal?.aborted)throw new Tn;return this._addRun(ue(this,ia,"m",hh).call(this))}static accumulateDelta(e,r){for(let[t,o]of Object.entries(r)){if(!e.hasOwnProperty(t)){e[t]=o;continue}let c=e[t];if(c==null){e[t]=o;continue}if(t==="index"||t==="type"){e[t]=o;continue}if(typeof c=="string"&&typeof o=="string")c+=o;else if(typeof c=="number"&&typeof o=="number")c+=o;else if(Yd(c)&&Yd(o))c=this.accumulateDelta(c,o);else if(Array.isArray(c)&&Array.isArray(o)){if(c.every(f=>typeof f=="string"||typeof f=="number")){c.push(...o);continue}for(let f of o){if(!Yd(f))throw new Error(`Expected array delta entry to be an object but got: ${f}`);let d=f.index;if(d==null)throw console.error(f),new Error("Expected array delta entry to have an `index` property");if(typeof d!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${d}`);let g=c[d];g==null?c.push(f):c[d]=this.accumulateDelta(g,f)}continue}else throw Error(`Unhandled record type: ${t}, deltaValue: ${o}, accValue: ${c}`);e[t]=c}return e}_addRun(e){return e}async _threadAssistantStream(e,r,t){return await this._createThreadAssistantStream(r,e,t)}async _runAssistantStream(e,r,t,o){return await this._createAssistantStream(r,e,t,o)}async _runToolAssistantStream(e,r,t,o){return await this._createToolAssistantStream(r,e,t,o)}};Nl=no,dh=function(e){if(!this.ended)switch(Rt(this,tv,e,"f"),ue(this,ia,"m",G7).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ue(this,ia,"m",K7).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ue(this,ia,"m",z7).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ue(this,ia,"m",$7).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},hh=function(){if(this.ended)throw new ht("stream has ended, this shouldn't happen");if(!ue(this,Ml,"f"))throw Error("Final run has not been received");return ue(this,Ml,"f")},$7=function(e){let[r,t]=ue(this,ia,"m",W7).call(this,e,ue(this,Ki,"f"));Rt(this,Ki,r,"f"),ue(this,ev,"f")[r.id]=r;for(let o of t){let c=r.content[o.index];c?.type=="text"&&this._emit("textCreated",c.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,r),e.data.delta.content)for(let o of e.data.delta.content){if(o.type=="text"&&o.text){let c=o.text,f=r.content[o.index];if(f&&f.type=="text")this._emit("textDelta",c,f.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(o.index!=ue(this,n0,"f")){if(ue(this,Ol,"f"))switch(ue(this,Ol,"f").type){case"text":this._emit("textDone",ue(this,Ol,"f").text,ue(this,Ki,"f"));break;case"image_file":this._emit("imageFileDone",ue(this,Ol,"f").image_file,ue(this,Ki,"f"));break}Rt(this,n0,o.index,"f")}Rt(this,Ol,r.content[o.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(ue(this,n0,"f")!==void 0){let o=e.data.content[ue(this,n0,"f")];if(o)switch(o.type){case"image_file":this._emit("imageFileDone",o.image_file,ue(this,Ki,"f"));break;case"text":this._emit("textDone",o.text,ue(this,Ki,"f"));break}}ue(this,Ki,"f")&&this._emit("messageDone",e.data),Rt(this,Ki,void 0,"f")}},z7=function(e){let r=ue(this,ia,"m",H7).call(this,e);switch(Rt(this,mh,r,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let t=e.data.delta;if(t.step_details&&t.step_details.type=="tool_calls"&&t.step_details.tool_calls&&r.step_details.type=="tool_calls")for(let c of t.step_details.tool_calls)c.index==ue(this,nv,"f")?this._emit("toolCallDelta",c,r.step_details.tool_calls[c.index]):(ue(this,ci,"f")&&this._emit("toolCallDone",ue(this,ci,"f")),Rt(this,nv,c.index,"f"),Rt(this,ci,r.step_details.tool_calls[c.index],"f"),ue(this,ci,"f")&&this._emit("toolCallCreated",ue(this,ci,"f")));this._emit("runStepDelta",e.data.delta,r);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Rt(this,mh,void 0,"f"),e.data.step_details.type=="tool_calls"&&ue(this,ci,"f")&&(this._emit("toolCallDone",ue(this,ci,"f")),Rt(this,ci,void 0,"f")),this._emit("runStepDone",e.data,r);break;case"thread.run.step.in_progress":break}},G7=function(e){ue(this,PS,"f").push(e),this._emit("event",e)},H7=function(e){switch(e.event){case"thread.run.step.created":return ue(this,Is,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let r=ue(this,Is,"f")[e.data.id];if(!r)throw Error("Received a RunStepDelta before creation of a snapshot");let t=e.data;if(t.delta){let o=Nl.accumulateDelta(r,t.delta);ue(this,Is,"f")[e.data.id]=o}return ue(this,Is,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ue(this,Is,"f")[e.data.id]=e.data;break}if(ue(this,Is,"f")[e.data.id])return ue(this,Is,"f")[e.data.id];throw new Error("No snapshot available")},W7=function(e,r){let t=[];switch(e.event){case"thread.message.created":return[e.data,t];case"thread.message.delta":if(!r)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let o=e.data;if(o.delta.content)for(let c of o.delta.content)if(c.index in r.content){let f=r.content[c.index];r.content[c.index]=ue(this,ia,"m",V7).call(this,c,f)}else r.content[c.index]=c,t.push(c);return[r,t];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(r)return[r,t];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},V7=function(e,r){return Nl.accumulateDelta(r,e)},K7=function(e){switch(Rt(this,rv,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Rt(this,Ml,e.data,"f"),ue(this,ci,"f")&&(this._emit("toolCallDone",ue(this,ci,"f")),Rt(this,ci,void 0,"f"));break;case"thread.run.cancelling":break}};var Bl=class extends Pe{constructor(){super(...arguments),this.steps=new r0(this._client)}create(e,r,t){let{include:o,...c}=r;return this._client.post(Fe`/threads/${e}/runs`,{query:{include:o},body:c,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:r.stream??!1})}retrieve(e,r,t){let{thread_id:o}=r;return this._client.get(Fe`/threads/${o}/runs/${e}`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,r,t){let{thread_id:o,...c}=r;return this._client.post(Fe`/threads/${o}/runs/${e}`,{body:c,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,r={},t){return this._client.getAPIList(Fe`/threads/${e}/runs`,Xt,{query:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}cancel(e,r,t){let{thread_id:o}=r;return this._client.post(Fe`/threads/${o}/runs/${e}/cancel`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async createAndPoll(e,r,t){let o=await this.create(e,r,t);return await this.poll(o.id,{thread_id:e},t)}createAndStream(e,r,t){return no.createAssistantStream(e,this._client.beta.threads.runs,r,t)}async poll(e,r,t){let o=Ke([t?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":t?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:c,response:f}=await this.retrieve(e,r,{...t,headers:{...t?.headers,...o}}).withResponse();switch(c.status){case"queued":case"in_progress":case"cancelling":let d=5e3;if(t?.pollIntervalMs)d=t.pollIntervalMs;else{let g=f.headers.get("openai-poll-after-ms");if(g){let v=parseInt(g);isNaN(v)||(d=v)}}await Es(d);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return c}}}stream(e,r,t){return no.createAssistantStream(e,this._client.beta.threads.runs,r,t)}submitToolOutputs(e,r,t){let{thread_id:o,...c}=r;return this._client.post(Fe`/threads/${o}/runs/${e}/submit_tool_outputs`,{body:c,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:r.stream??!1})}async submitToolOutputsAndPoll(e,r,t){let o=await this.submitToolOutputs(e,r,t);return await this.poll(o.id,r,t)}submitToolOutputsStream(e,r,t){return no.createToolAssistantStream(e,this._client.beta.threads.runs,r,t)}};Bl.Steps=r0;var oc=class extends Pe{constructor(){super(...arguments),this.runs=new Bl(this._client),this.messages=new t0(this._client)}create(e={},r){return this._client.post("/threads",{body:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(Fe`/threads/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,t){return this._client.post(Fe`/threads/${e}`,{body:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,r){return this._client.delete(Fe`/threads/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}createAndRun(e,r){return this._client.post("/threads/runs",{body:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,r){let t=await this.createAndRun(e,r);return await this.runs.poll(t.id,{thread_id:t.thread_id},r)}createAndRunStream(e,r){return no.createThreadAssistantStream(e,this._client.beta.threads,r)}};oc.Runs=Bl;oc.Messages=t0;var Qi=class extends Pe{constructor(){super(...arguments),this.realtime=new ac(this._client),this.chatkit=new ic(this._client),this.assistants=new Xf(this._client),this.threads=new oc(this._client)}};Qi.Realtime=ac;Qi.ChatKit=ic;Qi.Assistants=Xf;Qi.Threads=oc;var Ll=class extends Pe{create(e,r){return this._client.post("/completions",{body:e,...r,stream:e.stream??!1})}};var a0=class extends Pe{retrieve(e,r,t){let{container_id:o}=r;return this._client.get(Fe`/containers/${o}/files/${e}/content`,{...t,headers:Ke([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}};var jl=class extends Pe{constructor(){super(...arguments),this.content=new a0(this._client)}create(e,r,t){return this._client.post(Fe`/containers/${e}/files`,oi({body:r,...t},this._client))}retrieve(e,r,t){let{container_id:o}=r;return this._client.get(Fe`/containers/${o}/files/${e}`,t)}list(e,r={},t){return this._client.getAPIList(Fe`/containers/${e}/files`,Xt,{query:r,...t})}delete(e,r,t){let{container_id:o}=r;return this._client.delete(Fe`/containers/${o}/files/${e}`,{...t,headers:Ke([{Accept:"*/*"},t?.headers])})}};jl.Content=a0;var cc=class extends Pe{constructor(){super(...arguments),this.files=new jl(this._client)}create(e,r){return this._client.post("/containers",{body:e,...r})}retrieve(e,r){return this._client.get(Fe`/containers/${e}`,r)}list(e={},r){return this._client.getAPIList("/containers",Xt,{query:e,...r})}delete(e,r){return this._client.delete(Fe`/containers/${e}`,{...r,headers:Ke([{Accept:"*/*"},r?.headers])})}};cc.Files=jl;var i0=class extends Pe{create(e,r,t){let{include:o,...c}=r;return this._client.post(Fe`/conversations/${e}/items`,{query:{include:o},body:c,...t})}retrieve(e,r,t){let{conversation_id:o,...c}=r;return this._client.get(Fe`/conversations/${o}/items/${e}`,{query:c,...t})}list(e,r={},t){return this._client.getAPIList(Fe`/conversations/${e}/items`,Zs,{query:r,...t})}delete(e,r,t){let{conversation_id:o}=r;return this._client.delete(Fe`/conversations/${o}/items/${e}`,t)}};var lc=class extends Pe{constructor(){super(...arguments),this.items=new i0(this._client)}create(e={},r){return this._client.post("/conversations",{body:e,...r})}retrieve(e,r){return this._client.get(Fe`/conversations/${e}`,r)}update(e,r,t){return this._client.post(Fe`/conversations/${e}`,{body:r,...t})}delete(e,r){return this._client.delete(Fe`/conversations/${e}`,r)}};lc.Items=i0;var ql=class extends Pe{create(e,r){let t=!!e.encoding_format,o=t?e.encoding_format:"base64";t&&mn(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let c=this._client.post("/embeddings",{body:{...e,encoding_format:o},...r});return t?c:(mn(this._client).debug("embeddings/decoding base64 embeddings from base64"),c._thenUnwrap(f=>(f&&f.data&&f.data.forEach(d=>{let g=d.embedding;d.embedding=U7(g)}),f)))}};var s0=class extends Pe{retrieve(e,r,t){let{eval_id:o,run_id:c}=r;return this._client.get(Fe`/evals/${o}/runs/${c}/output_items/${e}`,t)}list(e,r,t){let{eval_id:o,...c}=r;return this._client.getAPIList(Fe`/evals/${o}/runs/${e}/output_items`,Xt,{query:c,...t})}};var Ul=class extends Pe{constructor(){super(...arguments),this.outputItems=new s0(this._client)}create(e,r,t){return this._client.post(Fe`/evals/${e}/runs`,{body:r,...t})}retrieve(e,r,t){let{eval_id:o}=r;return this._client.get(Fe`/evals/${o}/runs/${e}`,t)}list(e,r={},t){return this._client.getAPIList(Fe`/evals/${e}/runs`,Xt,{query:r,...t})}delete(e,r,t){let{eval_id:o}=r;return this._client.delete(Fe`/evals/${o}/runs/${e}`,t)}cancel(e,r,t){let{eval_id:o}=r;return this._client.post(Fe`/evals/${o}/runs/${e}`,t)}};Ul.OutputItems=s0;var uc=class extends Pe{constructor(){super(...arguments),this.runs=new Ul(this._client)}create(e,r){return this._client.post("/evals",{body:e,...r})}retrieve(e,r){return this._client.get(Fe`/evals/${e}`,r)}update(e,r,t){return this._client.post(Fe`/evals/${e}`,{body:r,...t})}list(e={},r){return this._client.getAPIList("/evals",Xt,{query:e,...r})}delete(e,r){return this._client.delete(Fe`/evals/${e}`,r)}};uc.Runs=Ul;var $l=class extends Pe{create(e,r){return this._client.post("/files",oi({body:e,...r},this._client))}retrieve(e,r){return this._client.get(Fe`/files/${e}`,r)}list(e={},r){return this._client.getAPIList("/files",Xt,{query:e,...r})}delete(e,r){return this._client.delete(Fe`/files/${e}`,r)}content(e,r){return this._client.get(Fe`/files/${e}/content`,{...r,headers:Ke([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:r=5e3,maxWait:t=1800*1e3}={}){let o=new Set(["processed","error","deleted"]),c=Date.now(),f=await this.retrieve(e);for(;!f.status||!o.has(f.status);)if(await Es(r),f=await this.retrieve(e),Date.now()-c>t)throw new Zo({message:`Giving up on waiting for file ${e} to finish processing after ${t} milliseconds.`});return f}};var o0=class extends Pe{};var c0=class extends Pe{run(e,r){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...r})}validate(e,r){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...r})}};var zl=class extends Pe{constructor(){super(...arguments),this.graders=new c0(this._client)}};zl.Graders=c0;var l0=class extends Pe{create(e,r,t){return this._client.getAPIList(Fe`/fine_tuning/checkpoints/${e}/permissions`,Cs,{body:r,method:"post",...t})}retrieve(e,r={},t){return this._client.get(Fe`/fine_tuning/checkpoints/${e}/permissions`,{query:r,...t})}delete(e,r,t){let{fine_tuned_model_checkpoint:o}=r;return this._client.delete(Fe`/fine_tuning/checkpoints/${o}/permissions/${e}`,t)}};var Gl=class extends Pe{constructor(){super(...arguments),this.permissions=new l0(this._client)}};Gl.Permissions=l0;var u0=class extends Pe{list(e,r={},t){return this._client.getAPIList(Fe`/fine_tuning/jobs/${e}/checkpoints`,Xt,{query:r,...t})}};var Hl=class extends Pe{constructor(){super(...arguments),this.checkpoints=new u0(this._client)}create(e,r){return this._client.post("/fine_tuning/jobs",{body:e,...r})}retrieve(e,r){return this._client.get(Fe`/fine_tuning/jobs/${e}`,r)}list(e={},r){return this._client.getAPIList("/fine_tuning/jobs",Xt,{query:e,...r})}cancel(e,r){return this._client.post(Fe`/fine_tuning/jobs/${e}/cancel`,r)}listEvents(e,r={},t){return this._client.getAPIList(Fe`/fine_tuning/jobs/${e}/events`,Xt,{query:r,...t})}pause(e,r){return this._client.post(Fe`/fine_tuning/jobs/${e}/pause`,r)}resume(e,r){return this._client.post(Fe`/fine_tuning/jobs/${e}/resume`,r)}};Hl.Checkpoints=u0;var Xi=class extends Pe{constructor(){super(...arguments),this.methods=new o0(this._client),this.jobs=new Hl(this._client),this.checkpoints=new Gl(this._client),this.alpha=new zl(this._client)}};Xi.Methods=o0;Xi.Jobs=Hl;Xi.Checkpoints=Gl;Xi.Alpha=zl;var f0=class extends Pe{};var fc=class extends Pe{constructor(){super(...arguments),this.graderModels=new f0(this._client)}};fc.GraderModels=f0;var Wl=class extends Pe{createVariation(e,r){return this._client.post("/images/variations",oi({body:e,...r},this._client))}edit(e,r){return this._client.post("/images/edits",oi({body:e,...r,stream:e.stream??!1},this._client))}generate(e,r){return this._client.post("/images/generations",{body:e,...r,stream:e.stream??!1})}};var Vl=class extends Pe{retrieve(e,r){return this._client.get(Fe`/models/${e}`,r)}list(e){return this._client.getAPIList("/models",Cs,e)}delete(e,r){return this._client.delete(Fe`/models/${e}`,r)}};var Kl=class extends Pe{create(e,r){return this._client.post("/moderations",{body:e,...r})}};var p0=class extends Pe{accept(e,r,t){return this._client.post(Fe`/realtime/calls/${e}/accept`,{body:r,...t,headers:Ke([{Accept:"*/*"},t?.headers])})}hangup(e,r){return this._client.post(Fe`/realtime/calls/${e}/hangup`,{...r,headers:Ke([{Accept:"*/*"},r?.headers])})}refer(e,r,t){return this._client.post(Fe`/realtime/calls/${e}/refer`,{body:r,...t,headers:Ke([{Accept:"*/*"},t?.headers])})}reject(e,r={},t){return this._client.post(Fe`/realtime/calls/${e}/reject`,{body:r,...t,headers:Ke([{Accept:"*/*"},t?.headers])})}};var d0=class extends Pe{create(e,r){return this._client.post("/realtime/client_secrets",{body:e,...r})}};var ao=class extends Pe{constructor(){super(...arguments),this.clientSecrets=new d0(this._client),this.calls=new p0(this._client)}};ao.ClientSecrets=d0;ao.Calls=p0;function Q7(n,e){return!e||!Bme(e)?{...n,output_parsed:null,output:n.output.map(r=>r.type==="function_call"?{...r,parsed_arguments:null}:r.type==="message"?{...r,content:r.content.map(t=>({...t,parsed:null}))}:r)}:OS(n,e)}function OS(n,e){let r=n.output.map(o=>{if(o.type==="function_call")return{...o,parsed_arguments:qme(e,o)};if(o.type==="message"){let c=o.content.map(f=>f.type==="output_text"?{...f,parsed:Mme(e,f.text)}:f);return{...o,content:c}}return o}),t=Object.assign({},n,{output:r});return Object.getOwnPropertyDescriptor(n,"output_text")||av(t),Object.defineProperty(t,"output_parsed",{enumerable:!0,get(){for(let o of t.output)if(o.type==="message"){for(let c of o.content)if(c.type==="output_text"&&c.parsed!==null)return c.parsed}return null}}),t}function Mme(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function Bme(n){return!!ih(n.text?.format)}function Lme(n){return n?.$brand==="auto-parseable-tool"}function jme(n,e){return n.find(r=>r.type==="function"&&r.name===e)}function qme(n,e){let r=jme(n.tools??[],e.name);return{...e,...e,parsed_arguments:Lme(r)?r.$parseRaw(e.arguments):r?.strict?JSON.parse(e.arguments):null}}function av(n){let e=[];for(let r of n.output)if(r.type==="message")for(let t of r.content)t.type==="output_text"&&e.push(t.text);n.output_text=e.join("")}var h0,iv,pc,sv,X7,Y7,J7,Z7,ov=class n extends tc{constructor(e){super(),h0.add(this),iv.set(this,void 0),pc.set(this,void 0),sv.set(this,void 0),Rt(this,iv,e,"f")}static createResponse(e,r,t){let o=new n(r);return o._run(()=>o._createOrRetrieveResponse(e,r,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createOrRetrieveResponse(e,r,t){let o=t?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),ue(this,h0,"m",X7).call(this);let c,f=null;"response_id"in r?(c=await e.responses.retrieve(r.response_id,{stream:!0},{...t,signal:this.controller.signal,stream:!0}),f=r.starting_after??null):c=await e.responses.create({...r,stream:!0},{...t,signal:this.controller.signal}),this._connected();for await(let d of c)ue(this,h0,"m",Y7).call(this,d,f);if(c.controller.signal?.aborted)throw new Tn;return ue(this,h0,"m",J7).call(this)}[(iv=new WeakMap,pc=new WeakMap,sv=new WeakMap,h0=new WeakSet,X7=function(){this.ended||Rt(this,pc,void 0,"f")},Y7=function(r,t){if(this.ended)return;let o=(f,d)=>{(t==null||d.sequence_number>t)&&this._emit(f,d)},c=ue(this,h0,"m",Z7).call(this,r);switch(o("event",r),r.type){case"response.output_text.delta":{let f=c.output[r.output_index];if(!f)throw new ht(`missing output at index ${r.output_index}`);if(f.type==="message"){let d=f.content[r.content_index];if(!d)throw new ht(`missing content at index ${r.content_index}`);if(d.type!=="output_text")throw new ht(`expected content to be 'output_text', got ${d.type}`);o("response.output_text.delta",{...r,snapshot:d.text})}break}case"response.function_call_arguments.delta":{let f=c.output[r.output_index];if(!f)throw new ht(`missing output at index ${r.output_index}`);f.type==="function_call"&&o("response.function_call_arguments.delta",{...r,snapshot:f.arguments});break}default:o(r.type,r);break}},J7=function(){if(this.ended)throw new ht("stream has ended, this shouldn't happen");let r=ue(this,pc,"f");if(!r)throw new ht("request ended without sending any events");Rt(this,pc,void 0,"f");let t=Ume(r,ue(this,iv,"f"));return Rt(this,sv,t,"f"),t},Z7=function(r){let t=ue(this,pc,"f");if(!t){if(r.type!=="response.created")throw new ht(`When snapshot hasn't been set yet, expected 'response.created' event, got ${r.type}`);return t=Rt(this,pc,r.response,"f"),t}switch(r.type){case"response.output_item.added":{t.output.push(r.item);break}case"response.content_part.added":{let o=t.output[r.output_index];if(!o)throw new ht(`missing output at index ${r.output_index}`);let c=o.type,f=r.part;c==="message"&&f.type!=="reasoning_text"?o.content.push(f):c==="reasoning"&&f.type==="reasoning_text"&&(o.content||(o.content=[]),o.content.push(f));break}case"response.output_text.delta":{let o=t.output[r.output_index];if(!o)throw new ht(`missing output at index ${r.output_index}`);if(o.type==="message"){let c=o.content[r.content_index];if(!c)throw new ht(`missing content at index ${r.content_index}`);if(c.type!=="output_text")throw new ht(`expected content to be 'output_text', got ${c.type}`);c.text+=r.delta}break}case"response.function_call_arguments.delta":{let o=t.output[r.output_index];if(!o)throw new ht(`missing output at index ${r.output_index}`);o.type==="function_call"&&(o.arguments+=r.delta);break}case"response.reasoning_text.delta":{let o=t.output[r.output_index];if(!o)throw new ht(`missing output at index ${r.output_index}`);if(o.type==="reasoning"){let c=o.content?.[r.content_index];if(!c)throw new ht(`missing content at index ${r.content_index}`);if(c.type!=="reasoning_text")throw new ht(`expected content to be 'reasoning_text', got ${c.type}`);c.text+=r.delta}break}case"response.completed":{Rt(this,pc,r.response,"f");break}}return t},Symbol.asyncIterator)](){let e=[],r=[],t=!1;return this.on("event",o=>{let c=r.shift();c?c.resolve(o):e.push(o)}),this.on("end",()=>{t=!0;for(let o of r)o.resolve(void 0);r.length=0}),this.on("abort",o=>{t=!0;for(let c of r)c.reject(o);r.length=0}),this.on("error",o=>{t=!0;for(let c of r)c.reject(o);r.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:t?{value:void 0,done:!0}:new Promise((c,f)=>r.push({resolve:c,reject:f})).then(c=>c?{value:c,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=ue(this,sv,"f");if(!e)throw new ht("stream ended without producing a ChatCompletion");return e}};function Ume(n,e){return Q7(n,e)}var m0=class extends Pe{list(e,r={},t){return this._client.getAPIList(Fe`/responses/${e}/input_items`,Xt,{query:r,...t})}};var g0=class extends Pe{count(e={},r){return this._client.post("/responses/input_tokens",{body:e,...r})}};var io=class extends Pe{constructor(){super(...arguments),this.inputItems=new m0(this._client),this.inputTokens=new g0(this._client)}create(e,r){return this._client.post("/responses",{body:e,...r,stream:e.stream??!1})._thenUnwrap(t=>("object"in t&&t.object==="response"&&av(t),t))}retrieve(e,r={},t){return this._client.get(Fe`/responses/${e}`,{query:r,...t,stream:r?.stream??!1})._thenUnwrap(o=>("object"in o&&o.object==="response"&&av(o),o))}delete(e,r){return this._client.delete(Fe`/responses/${e}`,{...r,headers:Ke([{Accept:"*/*"},r?.headers])})}parse(e,r){return this._client.responses.create(e,r)._thenUnwrap(t=>OS(t,e))}stream(e,r){return ov.createResponse(this._client,e,r)}cancel(e,r){return this._client.post(Fe`/responses/${e}/cancel`,r)}compact(e={},r){return this._client.post("/responses/compact",{body:e,...r})}};io.InputItems=m0;io.InputTokens=g0;var v0=class extends Pe{create(e,r,t){return this._client.post(Fe`/uploads/${e}/parts`,oi({body:r,...t},this._client))}};var dc=class extends Pe{constructor(){super(...arguments),this.parts=new v0(this._client)}create(e,r){return this._client.post("/uploads",{body:e,...r})}cancel(e,r){return this._client.post(Fe`/uploads/${e}/cancel`,r)}complete(e,r,t){return this._client.post(Fe`/uploads/${e}/complete`,{body:r,...t})}};dc.Parts=v0;var eM=async n=>{let e=await Promise.allSettled(n),r=e.filter(o=>o.status==="rejected");if(r.length){for(let o of r)console.error(o.reason);throw new Error(`${r.length} promise(s) failed - see the above errors`)}let t=[];for(let o of e)o.status==="fulfilled"&&t.push(o.value);return t};var x0=class extends Pe{create(e,r,t){return this._client.post(Fe`/vector_stores/${e}/file_batches`,{body:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,r,t){let{vector_store_id:o}=r;return this._client.get(Fe`/vector_stores/${o}/file_batches/${e}`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}cancel(e,r,t){let{vector_store_id:o}=r;return this._client.post(Fe`/vector_stores/${o}/file_batches/${e}/cancel`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async createAndPoll(e,r,t){let o=await this.create(e,r);return await this.poll(e,o.id,t)}listFiles(e,r,t){let{vector_store_id:o,...c}=r;return this._client.getAPIList(Fe`/vector_stores/${o}/file_batches/${e}/files`,Xt,{query:c,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async poll(e,r,t){let o=Ke([t?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":t?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:c,response:f}=await this.retrieve(r,{vector_store_id:e},{...t,headers:o}).withResponse();switch(c.status){case"in_progress":let d=5e3;if(t?.pollIntervalMs)d=t.pollIntervalMs;else{let g=f.headers.get("openai-poll-after-ms");if(g){let v=parseInt(g);isNaN(v)||(d=v)}}await Es(d);break;case"failed":case"cancelled":case"completed":return c}}}async uploadAndPoll(e,{files:r,fileIds:t=[]},o){if(r==null||r.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let c=o?.maxConcurrency??5,f=Math.min(c,r.length),d=this._client,g=r.values(),v=[...t];async function y(S){for(let E of S){let I=await d.files.create({file:E,purpose:"assistants"},o);v.push(I.id)}}let _=Array(f).fill(g).map(y);return await eM(_),await this.createAndPoll(e,{file_ids:v})}};var y0=class extends Pe{create(e,r,t){return this._client.post(Fe`/vector_stores/${e}/files`,{body:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,r,t){let{vector_store_id:o}=r;return this._client.get(Fe`/vector_stores/${o}/files/${e}`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,r,t){let{vector_store_id:o,...c}=r;return this._client.post(Fe`/vector_stores/${o}/files/${e}`,{body:c,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e,r={},t){return this._client.getAPIList(Fe`/vector_stores/${e}/files`,Xt,{query:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,r,t){let{vector_store_id:o}=r;return this._client.delete(Fe`/vector_stores/${o}/files/${e}`,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}async createAndPoll(e,r,t){let o=await this.create(e,r,t);return await this.poll(e,o.id,t)}async poll(e,r,t){let o=Ke([t?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":t?.pollIntervalMs?.toString()??void 0}]);for(;;){let c=await this.retrieve(r,{vector_store_id:e},{...t,headers:o}).withResponse(),f=c.data;switch(f.status){case"in_progress":let d=5e3;if(t?.pollIntervalMs)d=t.pollIntervalMs;else{let g=c.response.headers.get("openai-poll-after-ms");if(g){let v=parseInt(g);isNaN(v)||(d=v)}}await Es(d);break;case"failed":case"completed":return f}}}async upload(e,r,t){let o=await this._client.files.create({file:r,purpose:"assistants"},t);return this.create(e,{file_id:o.id},t)}async uploadAndPoll(e,r,t){let o=await this.upload(e,r,t);return await this.poll(e,o.id,t)}content(e,r,t){let{vector_store_id:o}=r;return this._client.getAPIList(Fe`/vector_stores/${o}/files/${e}/content`,Cs,{...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};var so=class extends Pe{constructor(){super(...arguments),this.files=new y0(this._client),this.fileBatches=new x0(this._client)}create(e,r){return this._client.post("/vector_stores",{body:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,r){return this._client.get(Fe`/vector_stores/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,r,t){return this._client.post(Fe`/vector_stores/${e}`,{body:r,...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}list(e={},r){return this._client.getAPIList("/vector_stores",Xt,{query:e,...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,r){return this._client.delete(Fe`/vector_stores/${e}`,{...r,headers:Ke([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}search(e,r,t){return this._client.getAPIList(Fe`/vector_stores/${e}/search`,Cs,{body:r,method:"post",...t,headers:Ke([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};so.Files=y0;so.FileBatches=x0;var Ql=class extends Pe{create(e,r){return this._client.post("/videos",gS({body:e,...r},this._client))}retrieve(e,r){return this._client.get(Fe`/videos/${e}`,r)}list(e={},r){return this._client.getAPIList("/videos",Zs,{query:e,...r})}delete(e,r){return this._client.delete(Fe`/videos/${e}`,r)}downloadContent(e,r={},t){return this._client.get(Fe`/videos/${e}/content`,{query:r,...t,headers:Ke([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}remix(e,r,t){return this._client.post(Fe`/videos/${e}/remix`,gS({body:r,...t},this._client))}};var b0,tM,cv,Xl=class extends Pe{constructor(){super(...arguments),b0.add(this)}async unwrap(e,r,t=this._client.webhookSecret,o=300){return await this.verifySignature(e,r,t,o),JSON.parse(e)}async verifySignature(e,r,t=this._client.webhookSecret,o=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");ue(this,b0,"m",tM).call(this,t);let c=Ke([r]).values,f=ue(this,b0,"m",cv).call(this,c,"webhook-signature"),d=ue(this,b0,"m",cv).call(this,c,"webhook-timestamp"),g=ue(this,b0,"m",cv).call(this,c,"webhook-id"),v=parseInt(d,10);if(isNaN(v))throw new As("Invalid webhook timestamp format");let y=Math.floor(Date.now()/1e3);if(y-v>o)throw new As("Webhook timestamp is too old");if(v>y+o)throw new As("Webhook timestamp is too new");let _=f.split(" ").map(R=>R.startsWith("v1,")?R.substring(3):R),S=t.startsWith("whsec_")?Buffer.from(t.replace("whsec_",""),"base64"):Buffer.from(t,"utf-8"),E=g?`${g}.${d}.${e}`:`${d}.${e}`,I=await crypto.subtle.importKey("raw",S,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let R of _)try{let N=Buffer.from(R,"base64");if(await crypto.subtle.verify("HMAC",I,N,new TextEncoder().encode(E)))return}catch{continue}throw new As("The given webhook signature does not match the expected signature")}};b0=new WeakSet,tM=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},cv=function(e,r){if(!e)throw new Error("Headers are required");let t=e.get(r);if(t==null)throw new Error(`Missing required header: ${r}`);return t};var NS,MS,lv,rM,Ut=class{constructor({baseURL:e=sc("OPENAI_BASE_URL"),apiKey:r=sc("OPENAI_API_KEY"),organization:t=sc("OPENAI_ORG_ID")??null,project:o=sc("OPENAI_PROJECT_ID")??null,webhookSecret:c=sc("OPENAI_WEBHOOK_SECRET")??null,...f}={}){if(NS.add(this),lv.set(this,void 0),this.completions=new Ll(this),this.chat=new nc(this),this.embeddings=new ql(this),this.files=new $l(this),this.images=new Wl(this),this.audio=new Rs(this),this.moderations=new Kl(this),this.models=new Vl(this),this.fineTuning=new Xi(this),this.graders=new fc(this),this.vectorStores=new so(this),this.webhooks=new Xl(this),this.beta=new Qi(this),this.batches=new Pl(this),this.uploads=new dc(this),this.responses=new io(this),this.realtime=new ao(this),this.conversations=new lc(this),this.evals=new uc(this),this.containers=new cc(this),this.videos=new Ql(this),r===void 0)throw new ht("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let d={apiKey:r,organization:t,project:o,webhookSecret:c,...f,baseURL:e||"https://api.openai.com/v1"};if(!d.dangerouslyAllowBrowser&&l7())throw new ht(`It looks like you're running in a browser-like environment.